<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages 文件託管服務</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- 頂部資訊列 -->
    <nav class="navbar navbar-expand-lg shadow-sm" id="main-navbar">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="bi bi-cloud-upload-fill me-2"></i>
                <span class="fw-bold">GitHub Pages 文件託管</span>
            </a>
            
            <div class="d-flex align-items-center gap-2">
                <!-- 使用者資訊區（已登入時顯示） -->
                <div id="navbar-user-info" class="d-none">
                    <div class="d-flex align-items-center gap-2">
                        <img id="navbar-user-avatar" class="rounded-circle" src="" alt="User Avatar" width="32" height="32">
                        <div class="user-info-text d-none d-md-block">
                            <div class="small fw-bold" id="navbar-user-name"></div>
                            <div class="small opacity-75" id="navbar-user-login" style="font-size: 0.75rem;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- 主題切換按鈕 -->
                <button id="theme-toggle-btn" class="btn btn-sm btn-outline-secondary" title="切換主題">
                    <i id="theme-icon" class="bi bi-sun-fill"></i>
                </button>
                
                <!-- 登出按鈕（已登入時顯示） -->
                <button id="navbar-logout-btn" class="btn btn-sm btn-outline-secondary d-none" title="登出">
                    <i class="bi bi-box-arrow-right"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="card shadow-lg border-0">
            <div class="card-body p-4 p-md-5">
                <!-- Header -->
                <div id="page-header" class="text-center mb-4">
                    <h1 class="display-5 fw-bold">
                        <i class="bi bi-cloud-upload-fill me-2"></i>
                        GitHub Pages 文件託管
                    </h1>
                    <p class="text-muted">使用 Personal Access Token 登入並管理你的文件</p>
                </div>

                <!-- 登入區段 -->
                <div id="login-section">
                    <div class="text-center">
                        <button id="login-btn" class="btn btn-primary btn-lg">
                            <i class="bi bi-github me-2"></i>
                            使用 GitHub Personal Access Token 登入
                        </button>
                    </div>
                    
                    <div id="token-input-section" class="d-none mt-4">
                        <div class="alert alert-info">
                            <h6 class="alert-heading"><i class="bi bi-info-circle me-2"></i>如何取得 Personal Access Token：</h6>
                            <ol class="mb-0 small">
                                <li>前往 <a href="https://github.com/settings/tokens/new" target="_blank" class="alert-link">GitHub Token 設定頁面</a></li>
                                <li>設定 Token 名稱（例如：File Hosting）</li>
                                <li>選擇 Expiration（建議選擇較短的期限）</li>
                                <li>勾選 <code>repo</code> 權限（完整存取權限）</li>
                                <li>點擊「Generate token」並複製產生的 token</li>
                            </ol>
                        </div>
                        <div class="input-group">
                            <input 
                                type="password" 
                                id="token-input" 
                                class="form-control form-control-lg"
                                placeholder="貼上你的 GitHub Personal Access Token"
                            >
                            <button id="token-login-btn" class="btn btn-success btn-lg">
                                <i class="bi bi-box-arrow-in-right me-2"></i>登入
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 已登入區段 -->
                <div id="authenticated-section" class="d-none">

                    <!-- 建立資料夾 -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="bi bi-folder-plus me-2"></i>建立資料夾</h5>
                        </div>
                        <div class="card-body">
                            <div class="input-group">
                                <input 
                                    type="text" 
                                    id="new-folder-input" 
                                    class="form-control"
                                    placeholder="例如: images, documents, photos"
                                >
                                <button id="create-folder-btn" class="btn btn-success">
                                    <i class="bi bi-plus-circle me-2"></i>建立
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 現有子資料夾顯示 -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="bi bi-folder-fill me-2"></i>現有資料夾</h5>
                            <button id="refresh-folders-btn" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-arrow-clockwise me-1"></i>重新整理
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="folders-grid" class="row g-3">
                                <div class="col-12 text-center text-muted py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">載入中...</span>
                                    </div>
                                    <p class="mt-2">載入資料夾列表...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 檔案上傳區 -->
                    <div id="upload-section" class="d-none">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-upload me-2"></i>上傳檔案
                                    <span class="text-muted" style="font-size: 0.875rem;">
                                        至 <code id="current-folder-name" class="text-primary"></code>
                                    </span>
                                </h5>
                            </div>
                            <div class="card-body">
                                <div 
                                    id="drop-zone" 
                                    class="drop-zone text-center p-5 border border-2 border-dashed rounded"
                                >
                                    <i class="bi bi-cloud-upload display-1 text-muted mb-3"></i>
                                    <p class="mb-2">將檔案拖曳到此處</p>
                                    <p class="text-muted small mb-3">或</p>
                                    <input type="file" id="file-input" class="d-none" multiple>
                                    <button id="select-files-btn" class="btn btn-outline-primary">
                                        <i class="bi bi-file-earmark-plus me-2"></i>選擇檔案
                                    </button>
                                </div>
                                
                                <!-- 上傳進度 -->
                                <div id="upload-progress" class="d-none mt-3">
                                    <div class="progress" style="height: 25px;">
                                        <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                             role="progressbar" style="width: 0%">0%</div>
                                    </div>
                                    <div id="upload-status" class="text-center mt-2 small text-muted"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 檔案列表 -->
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-files me-2"></i>
                                    檔案列表 <span id="file-count-badge" class="badge bg-secondary ms-2">0</span>
                                </h5>
                                <button id="refresh-files-btn" class="btn btn-sm btn-outline-secondary">
                                    <i class="bi bi-arrow-clockwise me-1"></i>重新整理
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <div id="file-list" class="list-group list-group-flush">
                                    <div class="text-center text-muted py-4">
                                        <i class="bi bi-folder2-open display-4"></i>
                                        <p class="mt-2">請先選擇或瀏覽資料夾</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Toast 通知容器 - 調整位置避免被導航列遮擋 -->
    <div class="toast-container position-fixed end-0 p-3" style="top: 70px; z-index: 9999;">
        <div id="message-toast" class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body d-flex align-items-center">
                    <i id="toast-icon" class="me-2"></i>
                    <span id="toast-message"></span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 載入設定檔 -->
    <script src="config.js"></script>

    <!-- 主要應用程式邏輯 -->
    <script type="module" src="js/app.js"></script>
</body>

</html>